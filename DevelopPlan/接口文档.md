## 接口文档（full-text-searching）

本文件汇总后端提供的 HTTP API。所有接口均返回统一响应结构 `Result<T>`；分页数据使用 `PageResult<T>`。

### 统一返回结构
- 成功：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": { }
}
```
- 失败：
```json
{
  "code": 500,
  "message": "错误信息",
  "data": null
}
```

### 分页结构
```json
{
  "records": [ ],
  "total": 0,
  "size": 10,
  "current": 1,
  "pages": 0
}
```

---

### 知识库分类管理接口 `KnowledgeBaseCategoryController`

数据模型：`KnowledgeBaseCategory`

| 字段 | 类型 | 含义 | 备注 |
|---|---|---|---|
| id | Long | 分类主键ID | 自增 |
| name | String | 分类名称 | - |
| kbId | Long | 所属知识库ID | 逻辑外键 → `t_knowledge_base.id` |
| createdBy | Long | 创建人用户ID | - |
| createdAt | LocalDateTime | 创建时间 | `yyyy-MM-dd HH:mm:ss` |
| updatedBy | Long | 更新人用户ID | - |
| updatedAt | LocalDateTime | 更新时间 | `yyyy-MM-dd HH:mm:ss` |

复合视图模型：`DocumentGroupVo`

| 字段 | 类型 | 含义 | 备注 |
|---|---|---|---|
| categoryList | List<KnowledgeBaseCategory> | 分类列表 | 字段含义见上表（`KnowledgeBaseCategory`） |
| documentList | List<KnowledgeDocument> | 文档列表 | 字段含义见“知识文档管理接口”的 `KnowledgeDocument` 表 |

基础路径：`/api/category`

1) 创建分类
- 方法/路径：POST `/create`
- 参数（form/query）：
  - `name` String，必填，分类名称
  - `knowledgeBaseId` Long，必填，知识库ID
- 响应：`Result<Void>`

参数说明：
- `name`：分类的人类可读名称；不能为空字符串。
- `knowledgeBaseId`：要归属的知识库主键；必须是已存在的知识库。

2) 删除分类
- 方法/路径：DELETE `/delete/{id}`
- 路径参数：`id` Long 分类ID
- 响应：`Result<Void>`

参数说明：
- `id`：分类主键；删除后该分类不再可用。

3) 更新分类
- 方法/路径：POST `/update/{id}`
- 路径参数：`id` Long 分类ID
- 参数（form/query）：`name` String 新分类名称
- 响应：`Result<Void>`

参数说明：
- `id`：分类主键；必须存在。
- `name`：新的分类名称；不能为空字符串。

4) 获取分类列表（含文档列表）
- 方法/路径：GET `/list`
- 参数（query）：
  - `knowledgeBaseId` Long，必填
  - `pageNum` Integer，默认1
  - `pageSize` Integer，默认20
- 响应：`Result<DocumentGroupVo>`

参数说明：
- `knowledgeBaseId`：目标知识库ID；用于只查询该知识库下的分组与文档。
- `pageNum`：页码，从1开始；小于1会被后端校验拒绝。
- `pageSize`：每页条数；小于1会被后端校验拒绝。
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "categoryList": [ { "id": 1, "name": "默认分组", "kbId": 1 } ],
    "documentList": [ { "id": 11, "kbId": 1, "title": "文档A" } ]
  }
}
```

---

### 知识库管理接口 `KnowledgeBaseController`

数据模型：`KnowledgeBase`

| 字段 | 类型 | 含义 | 备注/取值 |
|---|---|---|---|
| id | Long | 知识库主键ID | 自增 |
| title | String | 知识库名称 | - |
| baseId | String | 业务侧知识库标识 | dify中的知识库id（唯一标识） |
| coverImagePath | String | 封面图片路径/URL | 可空 |
| scopeType | Integer | 权限可见范围 | 代码注释：0=私密、1=公开；接口处使用1/2，请以接口为准 |
| descriptionInfo | String | 知识库描述 | 可空 |
| kbType | Integer | 知识库类型 | 0=默认，1=同步外部 |
| indexingType | Integer | 索引类型 | 业务自定义 |
| createdBy | Long | 创建人用户ID | - |
| createdAt | LocalDateTime | 创建时间 | `yyyy-MM-dd HH:mm:ss` |
| updatedBy | Long | 更新人用户ID | - |
| updatedAt | LocalDateTime | 更新时间 | `yyyy-MM-dd HH:mm:ss` |
| owner | String | 归属方标识 | 组织/小组/外部关联ID |
| permission | Integer | 成员内容权限 | 0=仅查看，1=可编辑 |
| tenantId | Long | 租户ID | 多租户场景 |
| dict | Map<String,Object> | 数据字典(JSON) | 以JSON持久化 |

基础路径：`/api/knowledge`

1) 创建知识库
- 方法/路径：POST `/create`
- 参数（form/query）：
  - `name` String，必填
  - `coverImagePath` String，可选
  - `scopeType` Integer，必填，1-私有/2-公开（默认1）
  - `descriptionInfo` String，可选
- 响应：`Result<Void>`

参数说明：
- `name`：知识库名称；不能为空。
- `coverImagePath`：封面图片路径或URL；可为空。
- `scopeType`：可见范围权限；1=私有（仅成员可见），2=公开（所有人可见）。
- `descriptionInfo`：知识库简介；可为空。

2) 删除知识库
- 方法/路径：DELETE `/delete/{id}`
- 路径参数：`id` Long
- 响应：`Result<Void>`

参数说明：
- `id`：知识库主键；删除后其下内容处理策略以后端实现为准（请谨慎操作）。

3) 获取知识库详情
- 方法/路径：GET `/detail/{id}`
- 路径参数：`id` Long
- 响应：`Result<KnowledgeBase>`

参数说明：
- `id`：知识库主键。

4) 更新知识库
- 方法/路径：POST `/update/{id}`
- 路径参数：`id` String（注意：该接口签名为 String）
- 参数（form/query）：
  - `name` String，必填
  - `coverImagePath` String，可选
  - `scopeType` Integer，必填，1/2
  - `descriptionInfo` String，可选
- 响应：`Result<Void>`

参数说明：
- `id`：知识库主键（字符串类型）；必须与目标知识库匹配。
- `name`：新名称；不能为空。
- `coverImagePath`：新封面路径；可空表示不修改。
- `scopeType`：新权限；1=私有，2=公开；传空将被校验拒绝。
- `descriptionInfo`：新描述；可空表示不修改。

5) 获取知识库列表
- 方法/路径：GET `/list`
- 参数（query）：
  - `page` Integer，默认1
  - `size` Integer，默认10（当前实现默认值为字符串"1"，以后端为准）
- 响应：`Result<PageResult<KnowledgeBase>>`

参数说明：
- `page`：页码，从1开始。
- `size`：每页条数；建议≥1；部分实现默认值可能为1，请在调用侧显式传入。

6) 设置知识库权限
- 方法/路径：POST `/setPermission`
- 参数（form/query）：
  - `id` String，必填，知识库ID
  - `scopeType` Integer，必填，1/2
- 响应：`Result<Void>`

参数说明：
- `id`：知识库主键（字符串）。
- `scopeType`：权限可见范围；1=私有，2=公开。

7) 获取知识库权限
- 方法/路径：POST `/getPermission`
- 参数（form/query）：`knowledgeBaseId` String，必填
- 响应：`Result<Integer>`（1/2）

参数说明：
- `knowledgeBaseId`：知识库主键（字符串）；返回值为1或2，语义同上。

8) 获取数据字典
- 方法/路径：GET `/{id}/dict`
- 路径参数：`id` Long
- 响应：`Result<Map<String,Object>>`

参数说明：
- `id`：知识库主键；返回JSON Map类型数据字典。

9) 更新数据字典
- 方法/路径：POST `/{id}/dict`
- 路径参数：`id` Long
- 请求体：`application/json` 任意 JSON Map
- 响应：`Result<Void>`

参数说明：
- `id`：知识库主键。
- 请求体：任意键值对（Map），用于以JSON形式保存到知识库的 `dict` 字段。

10) 上传知识库封面图片
- 方法/路径：POST `/cover/upload`
- Content-Type：`multipart/form-data`
- 表单字段：
  - `file` File，必填，图片类型（`image/*`）
- 响应：`Result<Map<String,String>>`，键：`coverImagePath`

参数说明：
- `file`：上传的封面图片文件；服务端校验：
  - 不可为空；
  - `Content-Type` 必须以 `image/` 开头；
  - 大小不超过 1MB（> 1024×1024 将被拒绝）。

示例响应：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "coverImagePath": "/upload/covers/kb-1.png"
  }
}
```

示例-获取详情响应：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "title": "我的知识库",
    "baseId": "KB-001",
    "coverImagePath": "/covers/1.png",
    "scopeType": 1,
    "descriptionInfo": "说明",
    "kbType": 0,
    "indexingType": 0,
    "owner": "group-1",
    "permission": 1,
    "dict": { "key": "value" }
  }
}
```

---

### 知识文档管理接口 `KnowledgeDocumentController`

数据模型：`KnowledgeDocument`

| 字段 | 类型 | 含义 | 备注/取值 |
|---|---|---|---|
| id | Long | 文档主键ID | 自增 |
| kbId | Long | 所属知识库ID | 逻辑外键 → `t_knowledge_base.id` |
| categoryId | Long | 文档分类ID | 可空；→ `t_knowledge_base_category.id` |
| content | String | 文档正文内容 | Markdown 文本 |
| title | String | 文档标题 | - |
| summary | String | 文档摘要 | 可空 |
| docSuffix | String | 文件后缀 | 如 md/txt |
| wordCount | Integer | 字数统计 | - |
| processingStatus | Integer | 处理状态 | 0=未开始，1=完成，2=处理中 |
| docStatus | Integer | 文档状态 | 0=不可用，1=可用 |
| delStatus | Integer | 删除状态 | 0=未删除，1=已删除（回收站） |
| docType | Integer | 文档类型 | 0=文本，1=图片，2=音频，3=视频，4=其他 |
| docMetadata | String | 文档元信息 | 建议JSON |
| fileId | Long | 关联文件ID | → `t_knowledge_file.id` |
| previewInfo | String | 预览信息/地址 | - |
| difyDocumentId | String | Dify 文档ID | 外部系统映射 |
| createdAt | LocalDateTime | 创建时间 | `yyyy-MM-dd HH:mm:ss` |
| createdBy | Long | 创建人用户ID | - |
| updatedBy | Long | 更新人用户ID | - |
| updatedAt | LocalDateTime | 更新时间 | `yyyy-MM-dd HH:mm:ss` |

基础路径：`/api/document`

1) 上传文件创建文档（绑定知识库/可选分组）
- 方法/路径：POST `/upload`
- Content-Type：`multipart/form-data`
- 表单字段：
  - `knowledgeId` Long，必填
  - `categoryId` Long，可选
  - `file` File，必填，仅支持 .txt/.md
- 响应：`Result<KnowledgeDocument>`

参数说明：
- `knowledgeId`：目标知识库主键；用于绑定文档归属。
- `categoryId`：可选的分类主键；为空则归属默认或未分组。
- `file`：上传文件；当前仅支持 `.txt`/`.md`。文件大小及命名规范以网关/服务配置为准。

示例响应：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 101,
    "kbId": 1,
    "categoryId": 9,
    "title": "README",
    "summary": "概述...",
    "docSuffix": "md",
    "wordCount": 1234,
    "processingStatus": 1,
    "docStatus": 1,
    "delStatus": 0,
    "docType": 0,
    "fileId": 555,
    "previewInfo": "/preview/101",
    "difyDocumentId": "dify_xxx"
  }
}
```

2) 更新文档
- 方法/路径：PUT `/{id}`
- 路径参数：`id` Long
- 请求体：`application/json` `KnowledgeDocument`（可部分字段）
- 响应：`Result<KnowledgeDocument>`（更新后的对象）

参数说明：
- `id`（路径）：目标文档主键；不能为空。
- 请求体：允许部分字段更新；若请求体包含 `id`，必须与路径 `id` 一致，否则报错。常见可更新字段如：`title`、`summary`、`content`、`categoryId` 等。

3) 获取文档详情
- 方法/路径：GET `/{id}`
- 路径参数：`id` Long
- 响应：`Result<KnowledgeDocument>`

参数说明：
- `id`：文档主键。

4) 删除文档（不进回收站）
- 注意：这个删除是直接物理删除，是不进回收站的，如果想要删除之后进入回收站调用回收站的"将文档移动到回收站"接口
- 方法/路径：DELETE `/{id}`
- 路径参数：`id` Long
- 参数（query）：`knowledgeId` Long，必填
- 响应：`Result<Void>`

参数说明：
- `id`（路径）：文档主键。
- `knowledgeId`：知识库主键；用于记录操作日志及鉴权场景。

5) 按知识库分页查询文档（仅MySQL）
- 方法/路径：GET `/page`
- 参数（query）：
  - `knowledgeId` Long，必填
  - `page` Integer，默认1
  - `size` Integer，默认10
- 响应：`Result<PageResult<KnowledgeDocument>>`

参数说明：
- `knowledgeId`：目标知识库主键。
- `page`：页码，从1开始。
- `size`：每页条数。

6) 全文检索
- 方法/路径：GET `/search`
- 参数（query）：
  - `keyword` String，必填
  - `page` Integer，默认1
  - `size` Integer，默认10
- 响应：`Result<PageResult<KnowledgeDocument>>`

参数说明：
- `keyword`：搜索关键词；支持中文分词与模糊匹配。
- `page`：页码，从1开始。
- `size`：每页条数。

7) 最近编辑文档
- 方法/路径：GET `/recent-edited`
- 参数（query）：
  - `knowledgeId` Long，必填
  - `page` Integer，默认1
  - `size` Integer，默认10
- 响应：`Result<PageResult<KnowledgeDocument>>`

参数说明：
- `knowledgeId`：目标知识库主键；基于操作日志聚合最近编辑记录。
- `page`：页码，从1开始。
- `size`：每页条数。

8) 从最近编辑中移除
- 方法/路径：DELETE `/recent-edited/{id}`
- 路径参数：`id` Long 文档ID
- 参数（query）：`knowledgeId` Long，必填
- 响应：`Result<Void>`

参数说明：
- `id`（路径）：文档主键；要从最近编辑列表中隐藏的目标。
- `knowledgeId`：知识库主键；只影响该知识库维度下的最近编辑展示。

9) 最近预览文档
- 方法/路径：GET `/recent-viewed`
- 参数（query）：
  - `knowledgeId` Long，可选
  - `userId` Long，可选
  - `page` Integer，默认1
  - `size` Integer，默认10
- 响应：`Result<PageResult<KnowledgeDocument>>`

参数说明：
- `knowledgeId`：按知识库过滤；不传则为全局维度。
- `userId`：按用户过滤（暂未接入鉴权时从请求传入）。
- `page`：页码，从1开始。
- `size`：每页条数。

---

### 知识库成员管理接口 `MemberController`

数据模型：`KnowledgeBaseMember`

| 字段 | 类型 | 含义 | 备注/取值 |
|---|---|---|---|
| id | Long | 成员记录主键ID | 自增 |
| kbId | Long | 知识库ID | 逻辑外键 → `t_knowledge_base.id` |
| userId | Long | 用户ID | - |
| memberType | Integer | 成员类型/角色 | 0=所有者(可管理)、1=管理员(可编辑)、3=成员(仅查看) |
| createdBy | Long | 创建人用户ID | - |
| createdAt | LocalDateTime | 创建时间 | `yyyy-MM-dd HH:mm:ss` |
| updatedBy | Long | 更新人用户ID | - |
| updatedAt | LocalDateTime | 更新时间 | `yyyy-MM-dd HH:mm:ss` |

请求体DTO：`MemberKbPermissionDto`

| 字段 | 类型 | 含义 | 备注 |
|---|---|---|---|
| knowledgeBaseId | Long | 知识库ID | 必填 |
| accessControls | List<MemberKbPermissionInfoDTO> | 成员权限列表 | 必填 |
| accessControls[].avatar | String | 头像URL | 可选 |
| accessControls[].name | String | 显示名称 | 可选 |
| accessControls[].targetId | String | 目标主体ID | 如用户ID/群组ID |
| accessControls[].targetType | String | 目标主体类型 | 如 user/group |
| accessControls[].permission | String | 权限 | 如 view/edit |

基础路径：`/api/member`

1) 批量添加成员
- 方法/路径：POST `/batch`
- 请求体：`application/json` `MemberKbPermissionDto`
```json
{
  "knowledgeBaseId": 1,
  "accessControls": [
    {
      "avatar": "https://...",
      "name": "张三",
      "targetId": "10001",
      "targetType": "user",
      "permission": "edit"
    }
  ]
}
```
- 响应：`Result<Void>`

参数说明（请求体字段）：
- `knowledgeBaseId`：知识库主键；必填。
- `accessControls`：成员权限数组；必填。
  - `avatar`：头像URL；可选。
  - `name`：显示名称；可选。
  - `targetId`：目标主体ID（如用户ID、群组ID等）；必填。
  - `targetType`：目标主体类型（如 user / group 等）；建议与前端枚举对齐。
  - `permission`：权限标识（如 view / edit 等）；以后端解析为准。

2) 删除成员
- 方法/路径：DELETE `/delete`
- 请求体：同上 `MemberKbPermissionDto`
- 响应：`Result<Void>`

参数说明：同“批量添加成员”。用于撤销相关主体的知识库访问权限。

3) 更新成员权限
- 方法/路径：POST `/update`
- 请求体：同上 `MemberKbPermissionDto`
- 响应：`Result<Void>`

参数说明：同“批量添加成员”。用于调整现有主体的权限级别。

4) 获取成员列表
- 方法/路径：GET `/list/{kbId}`
- 路径参数：`kbId` Long
- 参数（query）：`pageNum` Integer 默认1；`pageSize` Integer 默认10
- 响应：`Result<List<KnowledgeBaseMember>>`

参数说明：
- `kbId`：目标知识库主键。
- `pageNum`：页码，从1开始。
- `pageSize`：每页条数。

---

### 操作日志管理接口 `OperationLogController`

数据模型：`OperationLog` 与 `OperationLogVo`

`OperationLog` 字段：

| 字段 | 类型 | 含义 | 备注 |
|---|---|---|---|
| id | Long | 日志主键ID | 自增 |
| title | String | 操作描述 | - |
| operationType | Integer | 操作类型 | 业务自定义分类 |
| objectId | Long | 操作对象ID | 如知识库ID/文档ID |
| objectType | String | 操作对象类型 | 如 knowledge/document/member |
| KbId | Long | 知识库ID | 注意实体字段大小写为 `KbId` |
| createdBy | Long | 创建人用户ID | - |
| createdAt | LocalDateTime | 创建时间 | `yyyy-MM-dd HH:mm:ss` |
| updatedBy | Long | 更新人用户ID | - |
| updatedAt | LocalDateTime | 更新时间 | `yyyy-MM-dd HH:mm:ss` |

`OperationLogVo` 额外字段：

| 字段 | 类型 | 含义 | 备注 |
|---|---|---|---|
| documentTitle | String | 文档标题 | 便于展示 |
| username | String | 操作用户名 | 便于展示 |
| avatarUrl | String | 用户头像URL | 便于展示 |

基础路径：`/api/operationLogs`

1) 获取知识库操作日志列表
- 方法/路径：GET `/list`
- 参数（query）：
  - `kbId` Long，必填
  - `pageNum` Integer，默认1
  - `pageSize` Integer，默认10
- 响应：`Result<List<OperationLogVo>>`

参数说明：
- `kbId`：知识库主键；用于查询该知识库的操作轨迹。
- `pageNum`：页码，从1开始。
- `pageSize`：每页条数。
```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "title": "上传文档",
      "operationType": 1,
      "objectId": 101,
      "objectType": "document",
      "kbId": 1,
      "documentTitle": "README",
      "username": "张三",
      "avatarUrl": "https://..."
    }
  ]
}
```

---

### 回收站管理接口 `RecycleBinController`

数据模型：`KnowledgeDocument`

> 本节接口返回分页文档列表，字段定义同上“知识文档管理接口”的 `KnowledgeDocument` 表。

基础路径：`/api/recycle-bin`

1) 将文档移动到回收站
- 方法/路径：POST `/move/{documentId}`
- 路径参数：`documentId` Long
- 参数（query）：`userId` Long，必填
- 响应：`Result<Boolean>`（true 表示成功）

参数说明：
- `documentId`：目标文档主键；移动后在回收站可恢复。
- `userId`：执行操作的用户ID；当前用于记录操作日志（未接入统一鉴权时）。

2) 从回收站恢复文档
- 方法/路径：POST `/restore/{documentId}`
- 路径参数：`documentId` Long
- 参数（query）：`userId` Long，必填
- 响应：`Result<Boolean>`

参数说明：
- `documentId`：要恢复的文档主键。
- `userId`：执行恢复操作的用户ID。

3) 获取回收站列表
- 方法/路径：GET `/list`
- 参数（query）：
  - `kbId` Long，必填
  - `page` Integer，默认1
  - `size` Integer，默认10
- 响应：`Result<PageResult<KnowledgeDocument>>`

参数说明：
- `kbId`：知识库主键；仅查询该知识库回收站内的文档。
- `page`：页码，从1开始。
- `size`：每页条数。

4) 测试接口
- 方法/路径：GET `/test`
- 响应：`Result<String>`（固定文案）

---

### 常见错误码
- 200：成功
- 400：参数错误（如必填参数缺失、路径ID与请求体ID不一致等）
- 404：资源不存在
- 500：服务端错误

